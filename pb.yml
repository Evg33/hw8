---
- name: create build env
  hosts: build
  become: yes

  tasks:

  - name: Ensure pkgs is present
    apt:
      name:
       - docker.io
       - python3-pip
       - screen
       - htop
       - mc
      update_cache: yes

  - name: pip docker-compose
    pip:
      name: docker-compose

  - name: git checkout repo from hw 7
    git:
      repo: 'https://github.com/Evg33/test07.git'
      dest: hw07

  - name: Tear down existing services
    docker_compose:
      project_src: hw07
      state: absent

  - name: Create and start services
    docker_compose:
      project_src: hw07
    register: output

#  - debug:
#      var: output

  - name: Run `docker-compose up` again
    docker_compose:
      project_src: hw07
      build: no
    register: output

#  - debug:
#      var: output

  - assert:
      that: "not output.changed "

  - name: Stop all services
    docker_compose:
      project_src: hw07
      build: no
      stopped: yes
    register: output

#  - debug:
#      var: output

  - assert:
      that:
        - "not web.hw07_web_1.state.running"